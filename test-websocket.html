<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat API í…ŒìŠ¤íŠ¸</title>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    h1 { color: #333; border-bottom: 3px solid #007bff; padding-bottom: 10px; }
    h2 { color: #555; margin-top: 30px; border-left: 4px solid #007bff; padding-left: 10px; }
    .section {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .status {
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 6px;
      font-weight: bold;
    }
    .status.connected { background: #d4edda; color: #155724; }
    .status.disconnected { background: #f8d7da; color: #721c24; }
    .controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
      margin: 15px 0;
    }
    input, select, textarea {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    button {
      padding: 10px 20px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s;
    }
    button:hover { background: #0056b3; }
    button:disabled { background: #ccc; cursor: not-allowed; }
    button.danger { background: #dc3545; }
    button.danger:hover { background: #c82333; }
    button.success { background: #28a745; }
    button.success:hover { background: #218838; }
    #messages {
      border: 1px solid #ddd;
      padding: 15px;
      height: 400px;
      overflow-y: auto;
      background: #f9f9f9;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
    }
    .message {
      margin: 8px 0;
      padding: 8px;
      background: white;
      border-left: 4px solid #007bff;
      border-radius: 4px;
    }
    .message.error { border-left-color: #dc3545; }
    .message.success { border-left-color: #28a745; }
    .message.warning { border-left-color: #ffc107; }
    .api-section {
      border-top: 2px solid #eee;
      padding-top: 20px;
      margin-top: 20px;
    }
    .api-section h3 {
      color: #007bff;
      margin-bottom: 15px;
    }
    .response-box {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 10px;
      margin-top: 10px;
      max-height: 200px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 11px;
      white-space: pre-wrap;
    }
    .config-section {
      background: #fff3cd;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <h1>ğŸ’¬ Chat API í…ŒìŠ¤íŠ¸ ë„êµ¬</h1>
  
  <!-- ì„¤ì • -->
  <div class="section config-section">
    <h2>âš™ï¸ ì„¤ì •</h2>
    <div class="controls">
      <label>API Base URL:</label>
      <input type="text" id="apiBase" value="http://localhost:3000/api/v1" style="flex: 1;">
      <label>User ID:</label>
      <input type="number" id="userIdInput" placeholder="User ID" value="1" min="1">
    </div>
  </div>
  
  <!-- WebSocket ì—°ê²° ìƒíƒœ -->
  <div class="section">
    <h2>ğŸ”Œ WebSocket ì—°ê²°</h2>
    <div id="status" class="status disconnected">âŒ ì—°ê²° ì•ˆë¨</div>
    <div class="controls">
      <button onclick="connectWS()">ì—°ê²°</button>
      <button onclick="disconnectWS()">ì—°ê²° ëŠê¸°</button>
      <button onclick="pingWS()">Ping í…ŒìŠ¤íŠ¸</button>
    </div>
  </div>

  <!-- WebSocket API -->
  <div class="section">
    <h2>ğŸ“¡ WebSocket API</h2>
    
    <div class="api-section">
      <h3>room.join - ì±„íŒ…ë°© ì…ì¥</h3>
      <div class="controls">
        <input type="number" id="wsRoomId" placeholder="Chat Room ID" value="3" min="1">
        <button onclick="joinRoomWS()">ì±„íŒ…ë°© ì…ì¥</button>
      </div>
    </div>

    <div class="api-section">
      <h3>message.send - ë©”ì‹œì§€ ì „ì†¡</h3>
      <div class="controls">
        <input type="number" id="wsMsgRoomId" placeholder="Chat Room ID" value="3" min="1">
        <select id="wsMsgType">
          <option value="TEXT">TEXT</option>
          <option value="AUDIO">AUDIO</option>
          <option value="PHOTO">PHOTO</option>
          <option value="VIDEO">VIDEO</option>
        </select>
        <input type="text" id="wsMsgText" placeholder="ë©”ì‹œì§€ ë‚´ìš© (TEXTìš©)" value="ì•ˆë…•í•˜ì„¸ìš”!">
        <input type="text" id="wsMsgMediaUrl" placeholder="Media URL" value="https://example.com/media.mp3">
        <input type="number" id="wsMsgDuration" placeholder="Duration (ì´ˆ, AUDIOìš©)" value="5" min="1">
        <button onclick="sendMessageWS()">ë©”ì‹œì§€ ì „ì†¡</button>
      </div>
    </div>
  </div>

  <!-- REST API -->
  <div class="section">
    <h2>ğŸŒ REST API</h2>
    
    <div class="api-section">
      <h3>POST /chats/rooms - ì±„íŒ…ë°© ìƒì„±</h3>
      <div class="controls">
        <input type="number" id="createRoomTargetId" placeholder="Target User ID" value="2" min="1">
        <button onclick="createRoom()">ì±„íŒ…ë°© ìƒì„±</button>
      </div>
      <div id="createRoomResponse" class="response-box" style="display:none;"></div>
    </div>

    <div class="api-section">
      <h3>GET /chats/rooms - ì±„íŒ…ë°© ëª©ë¡</h3>
      <div class="controls">
        <input type="text" id="listRoomsCursor" placeholder="Cursor (ì„ íƒ)" value="">
        <input type="number" id="listRoomsSize" placeholder="Size" value="20" min="1" max="50">
        <button onclick="listRooms()">ëª©ë¡ ì¡°íšŒ</button>
      </div>
      <div id="listRoomsResponse" class="response-box" style="display:none;"></div>
    </div>

    <div class="api-section">
      <h3>GET /chats/rooms/{chatRoomId} - ì±„íŒ…ë°© ìƒì„¸</h3>
      <div class="controls">
        <input type="number" id="roomDetailId" placeholder="Chat Room ID" value="3" min="1">
        <button onclick="getRoomDetail()">ìƒì„¸ ì¡°íšŒ</button>
      </div>
      <div id="roomDetailResponse" class="response-box" style="display:none;"></div>
    </div>

    <div class="api-section">
      <h3>GET /chats/rooms/{chatRoomId}/messages - ë©”ì‹œì§€ ëª©ë¡</h3>
      <div class="controls">
        <input type="number" id="listMsgRoomId" placeholder="Chat Room ID" value="3" min="1">
        <input type="text" id="listMsgCursor" placeholder="Cursor (ì„ íƒ)" value="">
        <input type="number" id="listMsgSize" placeholder="Size" value="30" min="1" max="100">
        <button onclick="listMessages()">ë©”ì‹œì§€ ëª©ë¡</button>
      </div>
      <div id="listMessagesResponse" class="response-box" style="display:none;"></div>
    </div>

    <div class="api-section">
      <h3>POST /chats/rooms/{chatRoomId}/messages - ë©”ì‹œì§€ ì „ì†¡</h3>
      <div class="controls">
        <input type="number" id="sendMsgRoomId" placeholder="Chat Room ID" value="3" min="1">
        <select id="sendMsgType">
          <option value="TEXT">TEXT</option>
          <option value="AUDIO">AUDIO</option>
          <option value="PHOTO">PHOTO</option>
          <option value="VIDEO">VIDEO</option>
        </select>
        <input type="text" id="sendMsgText" placeholder="ë©”ì‹œì§€ ë‚´ìš© (TEXTìš©)" value="ì•ˆë…•í•˜ì„¸ìš”!">
        <input type="text" id="sendMsgMediaUrl" placeholder="Media URL" value="https://example.com/media.mp3">
        <input type="number" id="sendMsgDuration" placeholder="Duration (ì´ˆ, AUDIOìš©)" value="5" min="1">
        <button onclick="sendMessage()">ë©”ì‹œì§€ ì „ì†¡</button>
      </div>
      <div id="sendMessageResponse" class="response-box" style="display:none;"></div>
    </div>

    <div class="api-section">
      <h3>PATCH /chats/messages/{messageId}/read - ë©”ì‹œì§€ ì½ìŒ ì²˜ë¦¬</h3>
      <div class="controls">
        <input type="number" id="readMsgId" placeholder="Message ID" value="1" min="1">
        <button onclick="markAsRead()">ì½ìŒ ì²˜ë¦¬</button>
      </div>
      <div id="markAsReadResponse" class="response-box" style="display:none;"></div>
    </div>

    <div class="api-section">
      <h3>PATCH /chats/messages/{messageId} - ë©”ì‹œì§€ ì‚­ì œ</h3>
      <div class="controls">
        <input type="number" id="deleteMsgId" placeholder="Message ID" value="1" min="1">
        <button class="danger" onclick="deleteMessage()">ë©”ì‹œì§€ ì‚­ì œ</button>
      </div>
      <div id="deleteMessageResponse" class="response-box" style="display:none;"></div>
    </div>
  </div>

  <!-- ë¡œê·¸ -->
  <div class="section">
    <h2>ğŸ“‹ ë¡œê·¸</h2>
    <div id="messages"></div>
  </div>

  <script>
    let socket = null;
    let currentUserId = 1;

    function getApiBase() {
      return document.getElementById('apiBase').value || 'http://localhost:3000/api/v1';
    }

    function getUserId() {
      return parseInt(document.getElementById('userIdInput').value) || 1;
    }

    function updateStatus(connected) {
      const statusEl = document.getElementById('status');
      if (connected) {
        statusEl.textContent = `âœ… ì—°ê²°ë¨ - Socket ID: ${socket?.id || 'N/A'} (User ID: ${currentUserId})`;
        statusEl.className = 'status connected';
      } else {
        statusEl.textContent = 'âŒ ì—°ê²° ì•ˆë¨';
        statusEl.className = 'status disconnected';
      }
    }

    function appendMessage(msg, type = 'info') {
      const messagesDiv = document.getElementById('messages');
      const div = document.createElement('div');
      div.className = `message ${type}`;
      div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
      messagesDiv.appendChild(div);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    function showResponse(elementId, data, isError = false) {
      const el = document.getElementById(elementId);
      el.style.display = 'block';
      el.textContent = JSON.stringify(data, null, 2);
      el.style.borderLeftColor = isError ? '#dc3545' : '#28a745';
      el.style.borderLeftWidth = '4px';
      el.style.borderLeftStyle = 'solid';
    }

    // WebSocket ì—°ê²°
    function connectWS() {
      const userId = getUserId();
      if (!userId || userId <= 0) {
        alert('ìœ íš¨í•œ User IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }

      if (socket) {
        socket.disconnect();
      }

      currentUserId = userId;
      appendMessage(`ğŸ”Œ WebSocket ì—°ê²° ì‹œë„ ì¤‘... (userId: ${userId})`);
      
      socket = io('http://localhost:3000/chats', {
        path: '/ws',
        auth: { userId: userId },
        transports: ['websocket']
      });

      socket.on('connect', () => {
        appendMessage(`âœ… WebSocket ì—°ê²° ì„±ê³µ! Socket ID: ${socket.id}`, 'success');
        updateStatus(true);
      });

      socket.on('disconnect', (reason) => {
        appendMessage(`âŒ WebSocket ì—°ê²° ëŠê¹€: ${reason}`, 'error');
        updateStatus(false);
      });

      socket.on('connect_error', (error) => {
        appendMessage(`ğŸ”´ WebSocket ì—°ê²° ì˜¤ë¥˜: ${error.message}`, 'error');
        updateStatus(false);
      });

      socket.on('message.new', (data) => {
        appendMessage(`ğŸ“¨ ìƒˆ ë©”ì‹œì§€ ìˆ˜ì‹ : ${JSON.stringify(data, null, 2)}`, 'success');
      });

      socket.on('exception', (error) => {
        appendMessage(`âŒ WebSocket ì˜ˆì™¸: ${JSON.stringify(error, null, 2)}`, 'error');
      });
    }

    function disconnectWS() {
      if (socket) {
        socket.disconnect();
        socket = null;
        appendMessage('ì—°ê²°ì„ ëŠì—ˆìŠµë‹ˆë‹¤.');
        updateStatus(false);
      }
    }

    function pingWS() {
      if (!socket?.connected) {
        alert('ë¨¼ì € WebSocketì— ì—°ê²°í•˜ì„¸ìš”.');
        return;
      }

      socket.emit('ping', {}, (response) => {
        if (response) {
          appendMessage(`ğŸ“ Ping ì‘ë‹µ: ${JSON.stringify(response, null, 2)}`, 'success');
        }
      });
    }

    function joinRoomWS() {
      if (!socket?.connected) {
        alert('ë¨¼ì € WebSocketì— ì—°ê²°í•˜ì„¸ìš”.');
        return;
      }

      const roomId = parseInt(document.getElementById('wsRoomId').value);
      if (!roomId) {
        alert('Chat Room IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }

      appendMessage(`ğŸšª ì±„íŒ…ë°© ì…ì¥ ì‹œë„... (roomId: ${roomId})`);

      socket.emit('room.join', { chatRoomId: roomId }, (response) => {
        if (response) {
          appendMessage(`âœ… ì±„íŒ…ë°© ì…ì¥ ì„±ê³µ: ${JSON.stringify(response, null, 2)}`, 'success');
        }
      });

      socket.once('exception', (error) => {
        appendMessage(`âŒ ì±„íŒ…ë°© ì…ì¥ ì‹¤íŒ¨: ${JSON.stringify(error, null, 2)}`, 'error');
      });
    }

    function sendMessageWS() {
      if (!socket?.connected) {
        alert('ë¨¼ì € WebSocketì— ì—°ê²°í•˜ì„¸ìš”.');
        return;
      }

      const roomId = parseInt(document.getElementById('wsMsgRoomId').value);
      const type = document.getElementById('wsMsgType').value;
      const text = document.getElementById('wsMsgText').value;
      const mediaUrl = document.getElementById('wsMsgMediaUrl').value;
      const durationSec = parseInt(document.getElementById('wsMsgDuration').value);

      if (!roomId) {
        alert('Chat Room IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }

      const payload = {
        chatRoomId: roomId,
        type: type,
        text: type === 'TEXT' ? text : null,
        mediaUrl: type !== 'TEXT' ? mediaUrl : null,
        durationSec: type === 'AUDIO' ? durationSec : null
      };

      appendMessage(`ğŸ“¤ WebSocket ë©”ì‹œì§€ ì „ì†¡ ì¤‘... ${JSON.stringify(payload, null, 2)}`);

      const timeout = setTimeout(() => {
        appendMessage(`â±ï¸ ë©”ì‹œì§€ ì „ì†¡ íƒ€ì„ì•„ì›ƒ (ì‘ë‹µ ì—†ìŒ)`, 'error');
      }, 10000);

      socket.emit('message.send', payload, (response) => {
        clearTimeout(timeout);
        if (response) {
          appendMessage(`âœ… WebSocket ë©”ì‹œì§€ ì „ì†¡ ì„±ê³µ: ${JSON.stringify(response, null, 2)}`, 'success');
        } else {
          appendMessage(`âš ï¸ WebSocket ë©”ì‹œì§€ ì „ì†¡ ì‘ë‹µ ì—†ìŒ`, 'warning');
        }
      });

      socket.once('exception', (error) => {
        clearTimeout(timeout);
        appendMessage(`âŒ WebSocket ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨: ${JSON.stringify(error, null, 2)}`, 'error');
      });
    }

    // REST API í•¨ìˆ˜ë“¤
    async function apiCall(method, url, body = null) {
      const apiBase = getApiBase();
      const userId = getUserId();
      
      const fullUrl = `${apiBase}${url}`;
      
      appendMessage(`ğŸŒ ${method} ${fullUrl}`, 'info');
      appendMessage(`   Headers: x-user-id: ${userId}`, 'info');
      
      const options = {
        method,
        headers: {
          'Content-Type': 'application/json',
          'x-user-id': userId.toString()
        },
        mode: 'cors',
        credentials: 'include'
      };

      if (body) {
        options.body = JSON.stringify(body);
        appendMessage(`   Body: ${JSON.stringify(body, null, 2)}`, 'info');
      }

      try {
        const response = await fetch(fullUrl, options);
        const responseText = await response.text();
        
        appendMessage(`   Status: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
        
        let data;
        try {
          data = JSON.parse(responseText);
        } catch (e) {
          data = { raw: responseText };
        }
        
        return { 
          ok: response.ok, 
          status: response.status, 
          statusText: response.statusText,
          data,
          headers: Object.fromEntries(response.headers.entries())
        };
      } catch (error) {
        appendMessage(`   ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬: ${error.message}`, 'error');
        return { 
          ok: false, 
          error: error.message,
          details: error
        };
      }
    }

    async function createRoom() {
      const targetUserId = parseInt(document.getElementById('createRoomTargetId').value);
      if (!targetUserId) {
        alert('Target User IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }

      appendMessage(`ğŸ“¤ ì±„íŒ…ë°© ìƒì„± ìš”ì²­... (targetUserId: ${targetUserId})`);
      const result = await apiCall('POST', '/chats/rooms', { targetUserId });
      
      if (result.ok) {
        appendMessage(`âœ… ì±„íŒ…ë°© ìƒì„± ì„±ê³µ`, 'success');
        showResponse('createRoomResponse', result.data);
      } else {
        appendMessage(`âŒ ì±„íŒ…ë°© ìƒì„± ì‹¤íŒ¨: ${JSON.stringify(result.data, null, 2)}`, 'error');
        showResponse('createRoomResponse', result.data, true);
      }
    }

    async function listRooms() {
      const cursor = document.getElementById('listRoomsCursor').value;
      const size = parseInt(document.getElementById('listRoomsSize').value) || 20;
      
      let url = `/chats/rooms?size=${size}`;
      if (cursor) url += `&cursor=${encodeURIComponent(cursor)}`;

      appendMessage(`ğŸ“¤ ì±„íŒ…ë°© ëª©ë¡ ì¡°íšŒ...`);
      const result = await apiCall('GET', url);
      
      if (result.ok) {
        appendMessage(`âœ… ì±„íŒ…ë°© ëª©ë¡ ì¡°íšŒ ì„±ê³µ`, 'success');
        showResponse('listRoomsResponse', result.data);
      } else {
        appendMessage(`âŒ ì±„íŒ…ë°© ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨: ${JSON.stringify(result.data, null, 2)}`, 'error');
        showResponse('listRoomsResponse', result.data, true);
      }
    }

    async function getRoomDetail() {
      const roomId = parseInt(document.getElementById('roomDetailId').value);
      if (!roomId) {
        alert('Chat Room IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }

      appendMessage(`ğŸ“¤ ì±„íŒ…ë°© ìƒì„¸ ì¡°íšŒ... (roomId: ${roomId})`);
      const result = await apiCall('GET', `/chats/rooms/${roomId}`);
      
      if (result.ok) {
        appendMessage(`âœ… ì±„íŒ…ë°© ìƒì„¸ ì¡°íšŒ ì„±ê³µ`, 'success');
        showResponse('roomDetailResponse', result.data);
      } else {
        appendMessage(`âŒ ì±„íŒ…ë°© ìƒì„¸ ì¡°íšŒ ì‹¤íŒ¨: ${JSON.stringify(result.data, null, 2)}`, 'error');
        showResponse('roomDetailResponse', result.data, true);
      }
    }

    async function listMessages() {
      const roomId = parseInt(document.getElementById('listMsgRoomId').value);
      const cursor = document.getElementById('listMsgCursor').value;
      const size = parseInt(document.getElementById('listMsgSize').value) || 30;
      
      if (!roomId) {
        alert('Chat Room IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }

      let url = `/chats/rooms/${roomId}/messages?size=${size}`;
      if (cursor) url += `&cursor=${encodeURIComponent(cursor)}`;

      appendMessage(`ğŸ“¤ ë©”ì‹œì§€ ëª©ë¡ ì¡°íšŒ... (roomId: ${roomId})`);
      const result = await apiCall('GET', url);
      
      if (result.ok) {
        appendMessage(`âœ… ë©”ì‹œì§€ ëª©ë¡ ì¡°íšŒ ì„±ê³µ`, 'success');
        showResponse('listMessagesResponse', result.data);
      } else {
        appendMessage(`âŒ ë©”ì‹œì§€ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨: ${JSON.stringify(result.data, null, 2)}`, 'error');
        showResponse('listMessagesResponse', result.data, true);
      }
    }

    async function sendMessage() {
      const roomId = parseInt(document.getElementById('sendMsgRoomId').value);
      const type = document.getElementById('sendMsgType').value;
      const text = document.getElementById('sendMsgText').value;
      const mediaUrl = document.getElementById('sendMsgMediaUrl').value;
      const durationSec = parseInt(document.getElementById('sendMsgDuration').value);

      if (!roomId) {
        alert('Chat Room IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }

      const body = {
        type: type,
        text: type === 'TEXT' ? text : null,
        mediaUrl: type !== 'TEXT' ? mediaUrl : null,
        durationSec: type === 'AUDIO' ? durationSec : null
      };

      appendMessage(`ğŸ“¤ REST API ë©”ì‹œì§€ ì „ì†¡... (roomId: ${roomId})`);
      const result = await apiCall('POST', `/chats/rooms/${roomId}/messages`, body);
      
      if (result.ok) {
        appendMessage(`âœ… REST API ë©”ì‹œì§€ ì „ì†¡ ì„±ê³µ`, 'success');
        showResponse('sendMessageResponse', result.data);
      } else {
        appendMessage(`âŒ REST API ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨: ${JSON.stringify(result.data, null, 2)}`, 'error');
        showResponse('sendMessageResponse', result.data, true);
      }
    }

    async function markAsRead() {
      const messageId = parseInt(document.getElementById('readMsgId').value);
      if (!messageId) {
        alert('Message IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }

      appendMessage(`ğŸ“¤ ë©”ì‹œì§€ ì½ìŒ ì²˜ë¦¬... (messageId: ${messageId})`);
      const result = await apiCall('PATCH', `/chats/messages/${messageId}/read`);
      
      if (result.ok) {
        appendMessage(`âœ… ë©”ì‹œì§€ ì½ìŒ ì²˜ë¦¬ ì„±ê³µ`, 'success');
        showResponse('markAsReadResponse', result.data);
      } else {
        appendMessage(`âŒ ë©”ì‹œì§€ ì½ìŒ ì²˜ë¦¬ ì‹¤íŒ¨: ${JSON.stringify(result.data, null, 2)}`, 'error');
        showResponse('markAsReadResponse', result.data, true);
      }
    }

    async function deleteMessage() {
      const messageId = parseInt(document.getElementById('deleteMsgId').value);
      if (!messageId) {
        alert('Message IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
        return;
      }

      if (!confirm(`ì •ë§ ë©”ì‹œì§€ ${messageId}ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        return;
      }

      appendMessage(`ğŸ“¤ ë©”ì‹œì§€ ì‚­ì œ... (messageId: ${messageId})`);
      const result = await apiCall('PATCH', `/chats/messages/${messageId}`);
      
      if (result.ok) {
        appendMessage(`âœ… ë©”ì‹œì§€ ì‚­ì œ ì„±ê³µ`, 'success');
        showResponse('deleteMessageResponse', result.data);
      } else {
        appendMessage(`âŒ ë©”ì‹œì§€ ì‚­ì œ ì‹¤íŒ¨: ${JSON.stringify(result.data, null, 2)}`, 'error');
        showResponse('deleteMessageResponse', result.data, true);
      }
    }
  </script>
</body>
</html>